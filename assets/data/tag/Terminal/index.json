{"hash":"1a485f6dceb298c3ce36b831edab4aa62783906c","data":{"tag":{"title":"Terminal","belongsTo":{"edges":[{"node":{"title":"Yadmï¼šæˆ‘æ˜¯å¦‚ä½•åŒæ­¥å¹¶ç®¡ç†æˆ‘çš„ Dotfiles çš„ï¼Ÿ","path":"/2020/07/how-i-manage-my-dotfiles/","date":"July 24. 2020","timeToRead":13,"cjkWordCount":3019,"cjkReadTime":14,"description":"Yet Another Dotfiles Managerï¼ŒåŸºäº Git çš„ Dotfiles ç®¡ç†å™¨ã€‚","content":"<p>æ²¡æƒ³åˆ°å•Šï¼Œ<a href=\"https://github.com/spencerwooo/dotfiles\" title=\"æˆ‘çš„ dotfiles ä»“åº“\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">æˆ‘çš„ dotfiles ä»“åº“</a>ç«Ÿç„¶æ˜¯ç›®å‰æˆ‘ GitHub ä¸Šé¢æ˜Ÿæ˜Ÿæ•°é‡æœ€å¤šçš„å•ä»“åº“ã€‚</p>\n<p>Dotfiles é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨è½¯ä»¶çš„æ—¶å€™ï¼Œè½¯ä»¶ä¸ºäº†å­˜å‚¨æˆ‘ä»¬ä¸ªäººåå¥½è®¾ç½®è€Œå»ºç«‹çš„ä¸€ä¸ªä»¥ <code class=\"language-text\">.</code> å¼€å¤´çš„æ–‡ä»¶ã€‚</p>\n<blockquote>\n<p>User-specific application configuration is traditionally stored in so called <strong><em>dotfiles.</em></strong> <sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup></p>\n</blockquote>\n<p>æ¯”å¦‚ï¼Œç¼–è¾‘å™¨ Vim æœ‰ <code class=\"language-text\">.vimrc</code>ï¼Œå¸¸ç”¨çš„ Zshã€Bash ç­‰ Shell åˆ†åˆ«æœ‰ <code class=\"language-text\">.zshrc</code>ã€<code class=\"language-text\">.bashrc</code> ç­‰ç­‰ã€‚å¦å¤–ï¼Œå¹¿ä¹‰çš„ dotfiles ä¹ŸåŒ…æ‹¬ <code class=\"language-text\">JSON</code>ã€<code class=\"language-text\">TOML</code> ç­‰å¸¸è§„é…ç½®æ–‡ä»¶ï¼ˆå½“ç„¶ä¹ŸåŒ…å« Neovim çš„ <code class=\"language-text\">init.vim</code> ç­‰ç­‰ï¼‰ã€‚æ€»ä¹‹ï¼Œè¿™ä¹ˆå¤šçš„ dotfiles éƒ½æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡é…ç½®å®‰è£…å¥½ç³»ç»Ÿã€è½¯ä»¶ä¹‹åå­˜åœ¨äºæˆ‘ä»¬ç”µè„‘ä¸Šé¢çš„ä¸ªæ€§åŒ–é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯è¿™äº› dotfiles å¾€å¾€éƒ½åªå­˜åœ¨äºæˆ‘ä»¬ç”µè„‘ä¸Šç‹¬ä¸€ä»½ï¼Œä¸€æ—¦é‡ç½®ç³»ç»Ÿã€æ›´æ–°æ¢ä»£ï¼Œæ–°ç”µè„‘ä¸Šå°±æœ‰éœ€è¦é‡æ–°é…ç½®ä¸€éæ‰€æœ‰çš„ dotfiles æ‰èƒ½è¿˜åŸæˆ‘ä»¬åŸæœ¬çš„è®¾ç½®ã€‚æ‰‹åŠ¨é…ç½®è¿™äº›å†…å®¹ä¸€æƒ³å°±éå¸¸ç¹çï¼Œä¸ºäº†æœ€å¿«è®©æ–°ç”µè„‘èƒ½å¤Ÿç”¨ä¸Šæˆ‘ä»¬ç†Ÿæ‚‰çš„å·¥å…·å’Œé…ç½®ï¼Œä¹Ÿä¸ºäº†å¯¹æˆ‘ä»¬è‡ªå·±çš„é…ç½®è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å·¥å…·æ¥ç®¡ç†æˆ‘ä»¬çš„ dotfilesã€‚</p>\n<h2 id=\"ç”¨-git-çš„æ€æƒ³æ¥ç®¡ç†-dotfiles\"><a href=\"#%E7%94%A8-git-%E7%9A%84%E6%80%9D%E6%83%B3%E6%9D%A5%E7%AE%A1%E7%90%86-dotfiles\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>ç”¨ Git çš„æ€æƒ³æ¥ç®¡ç† dotfiles</h2>\n<p>å¦‚æœè¯´è¦ç®¡ç† dotfilesï¼Œæˆ‘çš„ç¬¬ä¸€ååº”å°±æ˜¯ç”¨ Git æ¥ç®¡ç†ï¼Œ<strong>æ¯•ç«Ÿä¸“ä¸šçš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œç”¨æ¥ç®¡ç†çº¯æ–‡æœ¬æ–‡ä»¶çš„ä¿®æ”¹å’ŒåŒæ­¥å†åˆé€‚ä¸è¿‡äº†ã€‚</strong>ç°åœ¨å‰é¢æåˆ°çš„é‚£ä¸ªæ˜Ÿæ˜Ÿæ•°é‡æœ€å¤šçš„ repo å°±æ˜¯æˆ‘æœ€åˆç”¨ Git æ¥å°†æˆ‘çš„ dotfiles é›†åˆåˆ°ä¸€ä¸ª GitHub ä»“åº“é‡Œé¢æ—¶æ‰€åšçš„å°è¯•ã€‚é‚£ä¸ªä»“åº“ç°åœ¨æ¥çœ‹å…¶å®æ¯”è¾ƒæ··ä¹±ï¼Œç”±äºæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Git ä»“åº“ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œå› æ­¤ä¸ºäº†ä¸‰ä¸ªç³»ç»Ÿçš„ dotfiles éƒ½åŒæ­¥äºä¸€ä¸ªä»“åº“é‡Œï¼Œæˆ‘å»ºç«‹äº†ä¸‰ä¸ªä¸åŒçš„æ–‡ä»¶å¤¹ï¼šmacOSã€Windows å’Œ Linuxã€‚åŒæ—¶æˆ‘ä¹Ÿå¾—æ‰‹åŠ¨å°†æˆ‘æœ¬åœ°çš„å®é™…ä¿®æ”¹å¤åˆ¶ç²˜è´´åˆ°è¿™ä¸€ dotfiles ä»“åº“ä¹‹ä¸­ã€‚</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200724-173035.png\" alt=\"æˆ‘ä¹‹å‰åˆ©ç”¨ Git æ‰‹åŠ¨åŒæ­¥çš„ Dotfiles ä»“åº“\"><figcaption>æˆ‘ä¹‹å‰åˆ©ç”¨ Git æ‰‹åŠ¨åŒæ­¥çš„ Dotfiles ä»“åº“</figcaption></figure>\n<p>é‚£ä¹ˆè¿™æ ·ç®¡ç†çš„å¼Šç«¯æ˜¾è€Œæ˜“è§ï¼šè¿™ä¸€ä»“åº“ä»…ä»…ç®—æ˜¯ã€Œä¸€ä¸ªé…ç½®å‚è€ƒã€ï¼Œ<strong>è€Œéå®é™…æ„ä¹‰ä¸Šçš„ portable dotfiles repositoryã€‚</strong>å¤šæœºåŒæ­¥é ç²˜è´´ï¼Œç‰ˆæœ¬æ§åˆ¶é è„‘è¢‹ï¼Œæœ‰æ—¶å€™æˆ‘çš„å·¥å…·æˆ–è€…é…ç½®æ›´æ¢äº†ï¼Œåªèƒ½å¾’æ‰‹æŠŠåŸæ¥çš„é…ç½®ç§»åŠ¨åˆ° <code class=\"language-text\">/archive</code> æ–‡ä»¶å¤¹ä¸‹â€¦â€¦è¿™æ ·ç®¡ç†ä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ï¼å¦‚æœæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ¯ä¸ª dotfile æ‰€åœ¨çš„åŸæœ¬ä½ç½®å°±å°†å…¶ç­¾å…¥ Git ç³»ç»Ÿè¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’Œè¿œç¨‹åŒæ­¥å°±å¥½äº†ã€‚ğŸˆ</p>\n<h2 id=\"yet-another-dotfiles-manager\"><a href=\"#yet-another-dotfiles-manager\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Yet Another Dotfiles Manager</h2>\n<p><code class=\"language-text\">yadm</code> â€”â€” Yet Another Dotfiles Managerï¼Œæ°å¥½å°±æ˜¯ä¸ºç®¡ç† dotfiles è€Œç”Ÿçš„ä¸€ä¸ªå·¥å…·ã€‚åˆ©ç”¨ <code class=\"language-text\">yadm</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ª dotfile çš„åŸå§‹ä½ç½®ï¼Œç”¨è¶…å‡ºåŸç”Ÿ Git æ‰€æ”¯æŒçš„åŠŸèƒ½ï¼Œæ¥ä»»æ„çš„ç®¡ç†ã€åŒæ­¥æˆ‘ä»¬çš„ dotfilesã€‚</p>\n<ul>\n<li><code class=\"language-text\">yadm</code> çš„å®˜æ–¹ GitHub åœ°å€ä½äºï¼š<a href=\"https://github.com/TheLocehiliosan/yadm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TheLocehiliosan/yadm</a></li>\n<li><code class=\"language-text\">yadm</code> çš„å®˜æ–¹ä»‹ç»äºæ–‡æ¡£ä½äºï¼š<a href=\"https://yadm.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Yet Another Dotfiles Manager</a></li>\n</ul>\n<p>é¦–å…ˆï¼Œå®é™…ä¸Š <code class=\"language-text\">yadm</code> çš„åº•å±‚ä¾æ—§æ˜¯ Gitï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ç”¨ <code class=\"language-text\">yadm</code> ç®¡ç† dotfiles çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¾æ—§æ˜¯ç”¨ Git æ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€è¿œç¨‹åŒæ­¥ç­‰ç­‰æ“ä½œçš„ã€‚ä½†æ˜¯ï¼Œ<code class=\"language-text\">yadm</code> åœ¨ Git çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿›è¡Œäº†åˆç†çš„åŠŸèƒ½æ‹“å±•ï¼š<code class=\"language-text\">yadm</code> èƒ½å¤Ÿè®©æˆ‘ä»¬ä¸å¿…è¢«ä¸€ä¸ª Git ä»“åº“æ–‡ä»¶å¤¹æ‰€é™åˆ¶ï¼Œä¸å¿…å°† <code class=\"language-text\">$HOME</code> ç›®å½•ä¸‹çš„å…¨éƒ¨éç›¸å…³æ–‡ä»¶æ”¾å…¥ <code class=\"language-text\">.gitignore</code>ï¼Œèƒ½å¤Ÿç›´æ¥ç®¡ç†åŒæ­¥ dotfile æ–‡ä»¶ã€‚</p>\n<p>æ€»ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code class=\"language-text\">yadm</code> è€Œä¸æ˜¯ç›´æ¥ç”¨ Git æ¥ç®¡ç† dotfiles çš„è¯ï¼š</p>\n<ul>\n<li>æˆ‘ä»¬ä¸å¿…å…³å¿ƒå½“å‰ç›®å½•æ˜¯å¦æ˜¯ Git ç›®å½•ï¼ˆé Git åˆå§‹åŒ–çš„ç›®å½•åŸç‰ˆ Git æ˜¯æ‹’ç»å·¥ä½œçš„ï¼š<code class=\"language-text\">fatal: not a git repository</code>ï¼‰ï¼›</li>\n<li>æˆ‘ä»¬ä¸å¿…å°†åŸ dotfile çš„ä½ç½®è¿›è¡Œç§»åŠ¨ï¼Œä¹Ÿä¸å¿…å°†åŸ dotfile é€šè¿‡è½¯é“¾æ¥ symlink åˆ°å…¶ä»–ä½ç½®æ¥ç»Ÿä¸€ç®¡ç†ï¼›</li>\n<li>ä½†æˆ‘ä»¬ä¾æ—§å¯ä»¥ç›´æ¥ä½¿ç”¨ Git çš„å…¨éƒ¨åŠŸåŠ›ï¼ŒåŒ…æ‹¬ Git åˆ†æ”¯ã€mergeã€rebaseã€ä½¿ç”¨ submodules ç­‰ç­‰ï¼›</li>\n</ul>\n<p>ä¸è¿‡ï¼Œ<code class=\"language-text\">yadm</code> æ˜¯ä¸€ä¸ª *NIX å·¥å…·ï¼Œå¦‚æœä½ ä½¿ç”¨ macOS æˆ–è€… Linuxï¼Œé‚£ä¹ˆæ²¡é—®é¢˜ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ <code class=\"language-text\">yadm</code> ç®¡ç† dotfilesï¼›ä½†æ˜¯å¦‚æœä½ ç”¨ Windowsï¼Œé‚£ä¹ˆå¾ˆé—æ†¾ï¼Œ<code class=\"language-text\">yadm</code> åªèƒ½åœ¨ WSL é‡Œé¢è¿›è¡Œå®‰è£…ã€‚ï¼ˆä¸è¿‡æ²¡äº‹ï¼è¿˜æ˜¯æœ‰è§£å†³åŠæ³•çš„ï¼ï¼‰</p>\n<h2 id=\"ç”¨-yadm-ç®¡ç†åŒæ­¥å¹¶è‡ªåŠ¨éƒ¨ç½²-dotfiles\"><a href=\"#%E7%94%A8-yadm-%E7%AE%A1%E7%90%86%E5%90%8C%E6%AD%A5%E5%B9%B6%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2-dotfiles\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>ç”¨ yadm ç®¡ç†ã€åŒæ­¥å¹¶è‡ªåŠ¨éƒ¨ç½² dotfiles</h2>\n<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç»ˆäºæ­£å¼å¼€å§‹ç”¨ <code class=\"language-text\">yadm</code> ç®¡ç†åŒæ­¥ dotfiles äº†ã€‚é¦–å…ˆï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…ï¼Œé‚£ä¹ˆæ ¹æ®ä½ ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå…ˆ<a href=\"https://yadm.io/docs/install\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">æŒ‰ç…§å®˜æ–¹å®‰è£…æ–‡æ¡£</a>å®‰è£… <code class=\"language-text\">yadm</code>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æŒ‰ç…§ã€Œæˆ‘å·²ç»æœ‰å¤§é‡ dotfilesï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç»Ÿä¸€è¿›è¡Œç³»ç»Ÿç®¡ç†ã€çš„æƒ…å†µï¼Œæ¥ç®€å•ä»‹ç» <code class=\"language-text\">yadm</code> çš„ä½¿ç”¨å’ŒåŠŸèƒ½ã€‚</p>\n<h3 id=\"ç”¨-github-ä»“åº“åŒæ­¥-dotfiles-æ–‡ä»¶\"><a href=\"#%E7%94%A8-github-%E4%BB%93%E5%BA%93%E5%90%8C%E6%AD%A5-dotfiles-%E6%96%87%E4%BB%B6\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>ç”¨ GitHub ä»“åº“åŒæ­¥ dotfiles æ–‡ä»¶</h3>\n<p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ª<strong>ç©ºçš„ç§æœ‰ä»“åº“</strong>ï¼ˆå»ºè®®é™¤éç‰¹åˆ«è‡ªä¿¡ï¼Œè¿˜æ˜¯ç”¨ç§æœ‰ä»“åº“æ¯”è¾ƒä¿é™©ï¼‰ï¼Œç”¨ä½œæˆ‘ä»¬æ•´ä¸ªç³»ç»Ÿ dotfiles çš„åŒæ­¥ä»“åº“ã€‚</p>\n<div class=\"admonition admonition-caution\"><div class=\"admonition-heading\"><h5><div class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z\"></path></svg></div>ğŸŒ æ³¨æ„</h5></div><div class=\"admonition-content\"><p>å»ºè®®è¿™é‡Œå¦‚æœæ˜¯ä»å¤´å¼€å§‹ï¼Œ<strong>ç›´æ¥åˆ›å»ºå®Œå…¨ç©ºç™½ï¼Œä¸å¸¦ README æˆ– LICENSE çš„ä»“åº“ä¸ºå®œã€‚</strong></p></div></div>\n<p>ä¹‹åï¼Œåœ¨æˆ‘ä»¬çš„æ ¹ç›®å½•ï¼ˆå³ <code class=\"language-text\">~/</code>ã€<code class=\"language-text\">$HOME</code>ï¼‰ä¸‹ï¼Œç›´æ¥åˆå§‹åŒ– <code class=\"language-text\">yadm</code> ä»“åº“å¹¶æ·»åŠ æˆ‘ä»¬éœ€è¦ç®¡ç†çš„ dotfile æ–‡ä»¶ï¼š</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># åˆå§‹åŒ– yadm ä»“åº“ï¼ˆåœ¨å“ªé‡Œéƒ½ä¸€æ ·å™¢ï¼ï¼‰</span>\nyadm init\n\n<span class=\"token comment\"># ç”¨ yadm æ·»åŠ  dotfile æ–‡ä»¶è‡³ä»“åº“</span>\nyadm <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>æŸä¸ª dotfile æ–‡ä»¶<span class=\"token operator\">></span>\n\n<span class=\"token comment\"># ç»§ç»­æ·»åŠ â€¦â€¦</span>\n\n<span class=\"token comment\"># æœ€åï¼Œå°†æ·»åŠ å¥½çš„ dotfile ç­¾å…¥ Git</span>\nyadm commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"&lt;å†™ä¸ª commit ä¿¡æ¯>\"</span></code></pre>\n<p>è¿™æ ·ï¼Œæœ¬åœ°çš„ <code class=\"language-text\">yadm</code> ä»“åº“å°±å·²ç»ç”¨ Git å­˜å‚¨å¥½äº†æˆ‘ä»¬ dotfile æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼Œä»¥åŠæœ€é‡è¦çš„ï¼šç›¸å¯¹äº <code class=\"language-text\">$HOME</code> çš„æ–‡ä»¶è·¯å¾„ï¼ˆå®é™…ä¸Šå°±æ˜¯ç»å¯¹è·¯å¾„ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æœ¬åœ°ä»“åº“è·Ÿåˆšåˆš GitHub ä¸Šé¢åˆ›å»ºå¥½çš„è¿œç¨‹ä»“åº“è¿›è¡Œå…³è”ï¼Œå¹¶å°†æœ¬åœ°æ›´æ–°æ¨é€è‡³è¿œç¨‹ï¼š</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">yadm remote <span class=\"token function\">add</span> origin <span class=\"token operator\">&lt;</span>åˆšåˆšå»ºç«‹çš„ GitHub è¿œç¨‹ä»“åº“åœ°å€<span class=\"token operator\">></span>\nyadm push <span class=\"token parameter variable\">-u</span> origin master</code></pre>\n<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±åƒå¹³æ—¥é‡Œç”¨ Git ä¸€æ ·å°†æˆ‘ä»¬åˆ†æ•£åœ¨ç³»ç»Ÿå„ä¸ªåœ°æ–¹çš„ dotfiles ç»Ÿä¸€ç­¾å…¥äº† <code class=\"language-text\">yadm</code> ç®¡ç†çš„ã€Œä¸“å± dotfiles ä»“åº“ã€é‡Œé¢ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å°† <code class=\"language-text\">yadm</code> ç†è§£æˆä¸€ä¸ªåœ¨ä»»æ„ç›®å½•ä¸‹éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ dotfiles ä¸“å± Git ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚ç”¨ <code class=\"language-text\">yadm list</code> å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨ <code class=\"language-text\">yadm</code> ç®¡ç†çš„å…¨éƒ¨ dotfiles åˆ—è¡¨ï¼Œå½“ç„¶ï¼Œ<code class=\"language-text\">yadm status</code> è·Ÿ <code class=\"language-text\">git status</code> ä¸€æ ·å¯ä»¥æŸ¥çœ‹æ¯ä¸ª dotfile æ–‡ä»¶çš„ä¿®æ”¹æƒ…å†µã€‚</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200724-202658.png\" alt=\"å‘½ä»¤ï¼šyadm list å’Œ yadm status\"><figcaption>å‘½ä»¤ï¼šyadm list å’Œ yadm status</figcaption></figure>\n<h3 id=\"å€ŸåŠ©-yadm-çš„-bootstrap-åŠŸèƒ½è‡ªåŠ¨é…ç½®ç¯å¢ƒ\"><a href=\"#%E5%80%9F%E5%8A%A9-yadm-%E7%9A%84-bootstrap-%E5%8A%9F%E8%83%BD%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>å€ŸåŠ© yadm çš„ bootstrap åŠŸèƒ½è‡ªåŠ¨é…ç½®ç¯å¢ƒ</h3>\n<p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…‰ç”¨ <code class=\"language-text\">yadm</code> å°† dotfiles åŒæ­¥åˆ°æœ¬åœ°æ˜¯ä¸å¤Ÿçš„ï¼Œæ‹¿åˆ°æ–°ç”µè„‘æˆ‘ä»¬è¿˜å¾—å®‰è£…è®¸å¤šå·¥å…·ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å³å¯å€ŸåŠ© <code class=\"language-text\">yadm</code> çš„ bootstrap åŠŸèƒ½ï¼Œè‡ªåŠ¨å°†ä»»åŠ¡è„šæœ¬çš„æ‰§è¡Œ hook åœ¨ <code class=\"language-text\">yadm</code> å…‹éš†ä¹‹åï¼Œå®Œæˆç¯å¢ƒçš„å…¨è‡ªåŠ¨éƒ¨ç½²ã€‚ä¸è¿‡ï¼Œ<code class=\"language-text\">yadm</code> çš„ bootstrap è„šæœ¬æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±æ’°å†™çš„ï¼Œé»˜è®¤ä½äº <code class=\"language-text\">$HOME/.config/yadm/bootstrap</code>ï¼Œè¿™é‡Œä¸è®ºæ˜¯ Bash è„šæœ¬ã€Python è„šæœ¬è¿˜æ˜¯ä»€ä¹ˆåˆ«çš„ï¼Œåªè¦æ˜¯å¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥ã€‚</p>\n<p>è¿™é‡Œæˆ‘ç»™æˆ‘è‡ªå·±ç®€å•å†™äº†ä¸€ä¸ª Bash è„šæœ¬ï¼Œè‡ªåŠ¨å®‰è£… Zshã€<a href=\"https://github.com/zplug/zplug\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">zplug</a> å’Œ Neovim ä¸‰ä¸ªè½¯ä»¶ / æ’ä»¶ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token assign-left variable\">system_type</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$system_type</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Linux\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token comment\"># install zsh, zplug, neovim</span>\n  <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span> <span class=\"token builtin class-name\">command</span> <span class=\"token parameter variable\">-v</span> <span class=\"token function\">zsh</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Installing zsh...\"</span>\n    <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">zsh</span>\n  <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">${<span class=\"token environment constant\">HOME</span>}</span>/.zplug/init.zsh <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Installing zplug...\"</span>\n    <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sL</span> --proto-redir -all,https https://cdn.jsdelivr.net/gh/zplug/installer/installer.zsh <span class=\"token operator\">|</span> <span class=\"token function\">zsh</span>\n  <span class=\"token keyword\">elif</span> <span class=\"token operator\">!</span> <span class=\"token builtin class-name\">command</span> <span class=\"token parameter variable\">-v</span> nvim <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Installing neovim...\"</span>\n    <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> neovim\n    <span class=\"token comment\"># sudo apt install python-neovim</span>\n    <span class=\"token comment\"># sudo apt install python3-neovim</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Installing neovim plugins with vim-plug...\"</span>\n    nvim <span class=\"token string\">\"+PlugUpdate\"</span> <span class=\"token string\">\"+PlugClean!\"</span> <span class=\"token string\">\"+PlugUpdate\"</span> <span class=\"token string\">\"+qall\"</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"All packages are installed.\"</span>\n  <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">fi</span></code></pre>\n<p>è¿™é‡Œå¿…é¡»æ³¨æ„çš„æ˜¯ï¼š</p>\n<ul>\n<li>æˆ‘ä»¬æ‰€ç¼–å†™çš„è‡ªåŠ¨ bootstrap è„šæœ¬æœ€å¥½æ˜¯ã€Œå¹‚ç­‰ã€çš„ï¼Œç®€å•æ¥è®²å°±æ˜¯æœ‰å¯¹è½¯ä»¶å½“å‰å­˜åœ¨çŠ¶æ€çš„æ£€æµ‹ï¼Œä»¥å…å‘ç”Ÿé‡å¤å®‰è£…ã€è¦†ç›–åŸå§‹é…ç½®çš„é—®é¢˜ï¼›</li>\n<li>æˆ‘ä»¬æœ€å¥½å…ˆå¯¹å½“å‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ£€æµ‹ï¼Œæ¯”å¦‚ macOS å’Œ Linux å®é™…ä¸Šç¯å¢ƒæœ‰å¾ˆå¤§ä¸åŒï¼Œéœ€è¦åŒºåˆ«å¤„ç†ï¼›</li>\n</ul>\n<p>æˆ‘ä»¬å¯ä»¥ç”¨ <code class=\"language-text\">yadm bootstrap</code> å‘½ä»¤æ¥æ‰‹åŠ¨æ‰§è¡Œä¸æµ‹è¯•è¿™ä¸€è„šæœ¬ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ç¼–å†™çš„ bootstrap å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒæ ·å¯ä»¥ç”¨ <code class=\"language-text\">yadm</code> ç­¾å…¥å¹¶è¿›è¡ŒåŒæ­¥ï¼Œå’Œæ™®é€š dotfile æ–‡ä»¶ä¸€æ ·å¤„ç†å³å¯ã€‚</p>\n<p>æ›´å¤šæœ‰å…³ <code class=\"language-text\">yadm</code> çš„ bootstrap åŠŸèƒ½è¯·å‚è€ƒï¼š<a href=\"https://yadm.io/docs/bootstrap\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yadm Docs - Bootstrap</a>.</p>\n<h3 id=\"å…¶ä»–åŠŸèƒ½\"><a href=\"#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>å…¶ä»–åŠŸèƒ½</h3>\n<p>é™¤äº†ä¸Šé¢ç®€å•çš„ dotfiles åŒæ­¥ä¸ç‰ˆæœ¬ç®¡ç†ã€bootstrap è‡ªåŠ¨ç¯å¢ƒéƒ¨ç½²ç­‰åŠŸèƒ½å¤–ï¼Œ<code class=\"language-text\">yadm</code> è¿˜å¯ä»¥ï¼š</p>\n<ul>\n<li>å¯¹æ•æ„Ÿæ–‡ä»¶ï¼ˆæ¯”å¦‚ SSH å¯†é’¥ã€SSH <code class=\"language-text\">config</code> æ–‡ä»¶â€¦â€¦ï¼‰è¿›è¡ŒåŠ å¯†ã€è§£å¯†ï¼Œæä¾›ç§æœ‰ä»“åº“ä»¥å¤–çš„é¢å¤–ä¸€å±‚ä¿æŠ¤ï¼š<a href=\"https://yadm.io/docs/encryption\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yadm Docs - Encryption</a>ï¼›</li>\n<li>é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿã€ä¸åŒçš„ç¯å¢ƒä»¥åŠä¸åŒçš„ç”µè„‘ç»´æŠ¤ä¸åŒç§ç±»çš„åŒä¸€è½¯ä»¶ / æ’ä»¶çš„ dotfile æ–‡ä»¶ï¼š<a href=\"https://yadm.io/docs/alternates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yadm Docs - Alternate Files</a>ã€<a href=\"https://yadm.io/docs/templates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yadm Docs - Templates</a>ï¼›</li>\n</ul>\n<p>è¿™ä¸¤ä¸ªåŠŸèƒ½æˆ‘è¿˜æœ‰å¾…ä½“éªŒä¸å¼€å‘ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‰å¾€å®˜æ–¹æ–‡æ¡£è¿›è¡Œç ”ç©¶ä½¿ç”¨ã€‚</p>\n<h2 id=\"faq\"><a href=\"#faq\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>FAQ</h2>\n<h3 id=\"ä½†æ˜¯æˆ‘æƒ³è®©-yadm-ç®¡ç†-home-ä»¥å¤–çš„æ–‡ä»¶æ€ä¹ˆåŠ\"><a href=\"#%E4%BD%86%E6%98%AF%E6%88%91%E6%83%B3%E8%AE%A9-yadm-%E7%AE%A1%E7%90%86-home-%E4%BB%A5%E5%A4%96%E7%9A%84%E6%96%87%E4%BB%B6%E6%80%8E%E4%B9%88%E5%8A%9E\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>ä½†æ˜¯æˆ‘æƒ³è®© yadm ç®¡ç† <code class=\"language-text\">$HOME</code> ä»¥å¤–çš„æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ</h3>\n<p>å‰é¢çš„è¡¨è¿°ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å·²ç»å‘ç°äº†ï¼Œ<code class=\"language-text\">yadm</code> é»˜è®¤æƒ…å†µä¸‹ä»…ç®¡ç† <code class=\"language-text\">$HOME</code> ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ªäººç”¨æˆ·çš„æ–‡ä»¶ã€‚<code class=\"language-text\">yadm</code> ä¸ä¼šå»ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ï¼Œæ¯”å¦‚ <code class=\"language-text\">/etc</code>ã€<code class=\"language-text\">/mnt</code> ä¸‹çš„æ–‡ä»¶ã€‚è¿™é‡Œçš„ <code class=\"language-text\">$HOME</code> å®é™…ä¸Šå°±æ˜¯ <code class=\"language-text\">yadm</code> çš„é»˜è®¤å·¥ä½œæ ‘ï¼Œå…¶çœŸå®æ–‡ä»¶è·¯å¾„ä½äº <code class=\"language-text\">/home/&lt;ä½ çš„ç”¨æˆ·å&gt;</code>ï¼Œ<code class=\"language-text\">yadm</code> ä¹Ÿã€Œæ ¹æ®è®¾è®¡ã€ä»…ç®¡ç†è¿™ä¸€ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè€Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¹Ÿæ˜¯å®Œå…¨åˆç†ã€å¤Ÿç”¨çš„ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç»§ç»­ç®¡ç† <code class=\"language-text\">/home/xxx</code> ä»¥å¤–åœ°æ–¹çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ã€Œæ‰©å¤§æ–‡ä»¶æ ‘çš„èŒƒå›´ã€ï¼Œæˆ–è€…ã€Œé€‰æ‹©ä½¿ç”¨å…¶ä»–ç›®å½•ä½œä¸ºä¸»æ–‡ä»¶æ ‘ã€ã€‚é¦–å…ˆï¼Œå…¶ä»–åœ°æ–¹çš„æ–‡ä»¶ <code class=\"language-text\">yadm</code> å¾ˆå¯èƒ½æ²¡æœ‰è¯»å†™æƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè®¾ç½®ä¸€ä¸ªä¸“é—¨ç”¨æ¥ç®¡ç†ç³»ç»Ÿæ–‡ä»¶çš„ <code class=\"language-text\">yadm</code> alias å‘½ä»¤ï¼š</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># ä½¿ç”¨ /etc/yadm ä½œä¸º yadm ç³»ç»Ÿæ–‡ä»¶ç®¡ç†çš„ç›®å½•</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">sysyadm</span><span class=\"token operator\">=</span><span class=\"token string\">\"sudo yadm -Y /etc/yadm\"</span></code></pre>\n<p>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code class=\"language-text\">sysyadm</code> å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„è¿œç¨‹ä»“åº“ï¼Œæ¥å•ç‹¬ç®¡ç†ç³»ç»Ÿæ–‡ä»¶ï¼š</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># å°† / ç›®å½•åˆå§‹åŒ–ä¸º sysyadm çš„æ–‡ä»¶æ ‘</span>\nsysyadm init <span class=\"token parameter variable\">-w</span> /\n\n<span class=\"token comment\"># å’Œ yadm ä¸€æ ·ï¼Œæ·»åŠ æ–‡ä»¶ã€ç­¾å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€åŒæ­¥è¿œç¨‹ä»“åº“</span>\nsysyadm <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>æŸä¸ª / è·¯å¾„ä¸‹çš„ç³»ç»Ÿæ–‡ä»¶<span class=\"token operator\">></span>\nsysyadm commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"&lt;å•Šï¼Œæˆ‘ç­¾å…¥äº†ä¸€ä¸ªç³»ç»Ÿæ–‡ä»¶è€¶>\"</span>\n<span class=\"token comment\"># â€¦â€¦</span></code></pre>\n<p>å½“ç„¶ï¼Œä½ ä»…ä½¿ç”¨ <code class=\"language-text\">sysyadm</code> ç®¡ç†æ•´ä¸ªç³»ç»Ÿé‡Œé¢çš„å…¨éƒ¨ dotfiles ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä½ å¯èƒ½æ¯æ¬¡éƒ½éœ€è¦ç”³è¯· sudo æƒé™ï¼Œä¸å¤ªä¼˜é›…ã€‚</p>\n<p>æ›´å¤šä½¿ç”¨ç»†èŠ‚è¯·è§ï¼š<a href=\"https://yadm.io/docs/faq#unconventional-cases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">yadm Docs - FAQ #Unconventional Cases</a>.</p>\n<h3 id=\"æˆ‘ä»¬è¿™äº›-windows-ç”¨æˆ·æ€ä¹ˆåŠ\"><a href=\"#%E6%88%91%E4%BB%AC%E8%BF%99%E4%BA%9B-windows-%E7%94%A8%E6%88%B7%E6%80%8E%E4%B9%88%E5%8A%9E\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>æˆ‘ä»¬è¿™äº› Windows ç”¨æˆ·æ€ä¹ˆåŠï¼Ÿ</h3>\n<p>ä»€ä¹ˆæ—¶å€™æˆ‘ä»¬ Windows ç”¨æˆ·æ‰èƒ½ç«™èµ·æ¥ï¼æ°”æŠ–å†·ã€‚</p>\n<p>å®é™…ä¸Šï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·ä½¿ç”¨ WSLï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨ä¸Šæ–‡çš„æ–¹æ³•å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡Œ Windows çš„ dotfiles ç®¡ç†ã€‚åœ¨ WSL ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ <code class=\"language-text\">yadm</code> æ‹¿åˆ°çš„ Windows æ–‡ä»¶ä¸€èˆ¬ä½äº <code class=\"language-text\">/mnt/c/Users/&lt;ä½ çš„ç”¨æˆ·å&gt;</code> é‡Œé¢ã€‚å› æ­¤ï¼Œè¿™ä¸€æƒ…å†µéœ€è¦æˆ‘ä»¬å°† <code class=\"language-text\">yadm</code> çš„å·¥ä½œæ ‘è®¾å®šåœ¨ <code class=\"language-text\">/</code> æˆ– <code class=\"language-text\">/mnt</code> ç›®å½•ä¸‹ï¼Œæ‰å¯ä»¥æœ‰æ•ˆç®¡ç† Windows æ–‡ä»¶ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—æœ‰ç‚¹åˆ«æ‰­ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘éœ€è¦ç»™ <code class=\"language-text\">yadm</code> æƒé™ç›´æ¥ç®¡ç†æ•´ä¸ª <code class=\"language-text\">/</code> ç›®å½•ä¸‹çš„æ–‡ä»¶çš„æ—¶å€™ã€‚å› æ­¤ï¼Œä¸ºäº†æ–¹ä¾¿ï¼ˆå¹¶ä¸æ–¹ä¾¿ï¼‰ï¼Œæˆ‘è¿˜æ˜¯åœ¨ WSL çš„ <code class=\"language-text\">$HOME</code> é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª <code class=\"language-text\">~/Dotfiles/Windows</code> ç›®å½•ï¼Œç”¨ä¼ ç»ŸåŠæ³•ï¼Œæ‰‹åŠ¨å¤åˆ¶ç²˜è´´ Windows é‡Œé¢çš„ dotfiles ä½œä¸ºã€Œé…ç½®æ–‡ä»¶å‚è€ƒã€ã€‚</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200724-211554.png\" alt=\"åœ¨ WSL é‡Œé¢æ‰‹åŠ¨ç®¡ç† Windows ä¸­çš„ Dotfiles\"><figcaption>åœ¨ WSL é‡Œé¢æ‰‹åŠ¨ç®¡ç† Windows ä¸­çš„ Dotfiles</figcaption></figure>\n<p>å½“ç„¶ï¼Œè¿˜å¥½ Windows éœ€è¦åŒæ­¥çš„æ–‡ä»¶ä¸ç®—å¤ªå¤æ‚ï¼Œè€Œä¸”ä¸»è¦ä¸ºäº†åŒæ­¥ä¸€ä¸‹ Windows Terminal çš„è‡ªå®šä¹‰å›¾æ ‡ï¼Œè¿˜å¥½è¿˜å¥½ã€‚</p>\n<h2 id=\"å°ç»“\"><a href=\"#%E5%B0%8F%E7%BB%93\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>å°ç»“</h2>\n<p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘å…¶å®å‘ç°è‡ªå·±å·²ç»ç®—æ˜¯ä¸å¤ªç®¡æ›¾ç»é‚£ä¸ªç”¨ç¬¨æ–¹æ³•ç®¡ç†çš„ <a href=\"https://github.com/spencerwooo/dotfiles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">spencerwooo/dotfiles</a> ä»“åº“äº†ï¼Œå³ä½¿æ ‡æ˜Ÿçš„äººé‚£ä¹ˆå¤šã€‚ï¼ˆå•Šè¿™ï¼Œå†™ç€å†™ç€è¿˜å‘ç°<a href=\"https://github.com/spencerwooo/dotfiles/issues/9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">æœ‰ä¸ªè€å“¥å‘äº†ä¸ª issue</a>ï¼Œäººå‚»äº†ã€‚ï¼‰å¥½äº†ï¼Œæœ¬æ–‡åˆ°è¿™é‡Œå°±ç»“æŸå•¦ï¼Œæ„Ÿè°¢é˜…è¯»ã€‚(ï¼ _ï¼ ;)</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p><a href=\"https://wiki.archlinux.org/index.php/Dotfiles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://wiki.archlinux.org/index.php/Dotfiles</a></p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">â†©</a>\n</li>\n</ol>\n</div>\n"}},{"node":{"title":"ã€Œè¾“å‡ºã€å¼€é”€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬å‘ stdout è¾“å‡ºæ—¶é‚£ä¹ˆæ…¢ï¼Ÿ","path":"/2020/02/stdout-overhead/","date":"February 22. 2020","timeToRead":7,"cjkWordCount":1230,"cjkReadTime":6,"description":"Console output overhead: why is writing to stdout so slow?","content":"<blockquote>\n<p>æœ¬æ–‡å‘å¸ƒäº Medium: <a href=\"https://medium.com/spencerweekly/console-output-overhead-why-is-writing-to-stdout-so-slow-b0cc7c88704c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Console output overhead: why is writing to stdout so slow?</a></p>\n</blockquote>\n<p>Generally, when we code through our projects, we need to output certain values in order to understand what the program is currently doing and what results it shows. Normally we do this with a simple print function:</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hey look, this is the result.'</span><span class=\"token punctuation\">)</span></code></pre>\n<p>And for most of our use cases, this would be more than enough. However, when we are outputting a huge amount of data, like printing a file with 10k lines of text onto the terminal, we will eventually suffer from IO bottlenecks. This is something I discovered when trying to find a nice progress bar library for PyTorch in order to monitor the modelâ€™s training progress. Let me explain.</p>\n<h2 id=\"what-did-i-discover\"><a href=\"#what-did-i-discover\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What did I discover?</h2>\n<p>Now, if you are familiar with modern neural network libraries, you may have heard of Keras. Keras is a highly encapsulated library that takes care of data output, model compilation, backward propaganda and more for you under the hood, meaning that it offers less agility than other low-level libraries like PyTorch. The one feature I really appreciate about Keras is its nice little training progress bar that shows the current training progress, iteration duration, ETA, loss and other relevant statistics. Below is an example.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810.png\" alt=\"Visualizing training progress with Keras\"><figcaption>Visualizing training progress with Keras</figcaption></figure>\n<p>However, PyTorch offers far more customizable features when it comes to designing, compiling and training your model, but it also means you have to take care of outputting progress, training details and others by yourself. This is when I discovered IO bottlenecks when outputting directly to <code class=\"language-text\">stdout</code>, that is, your terminal.</p>\n<p>The library I first tried is called <a href=\"https://github.com/yueyericardo/pkbar\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong>pkbar</strong> â€” a progress bar library intended to bring Keras style progress monitoring to the PyTorch ecosystem</a>. <strong>(Donâ€™t use it!)</strong> Itâ€™s outputs are like this:</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-1.png\" alt=\"pkbar: Keras style progress bar for PyTorch\"><figcaption>pkbar: Keras style progress bar for PyTorch</figcaption></figure>\n<p>Most progress bar libraries are implemented by wrapping itself around an iterative object, in our case, a PyTorch Data Loader. When building a progress bar, we need to refresh our progress, statistics and other parameters on each iteration. This means every time we come to the end of an iteration, we need to output to our terminal with a delay when the program waits for the writing to return. This delay is often unnoticed when we are simply writing a single message, but when we are iterating through thousands of images, we need to write the latest status on each iteration. A small delay multiplied by a thousand iterations gives us a huge time difference, and results in bottlenecks we encounter now.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-2.png\" alt=\"Each iteration comes with a time cost that adds up to be a huge delay\"><figcaption>Each iteration comes with a time cost that adds up to be a huge delay</figcaption></figure>\n<p>What happened to me when I was using pkbar was exactly what I described above: <strong>each iteration was accompanied with a delay which eventually builds up into a time difference I simply canâ€™t ignore.</strong> To put numbers into perspective, I was applying a DeepFool adversarial attack on a pre-trained ResNet18 CNN. It took about 5 minutes on my laptop running on GPU without pkbar, and when I added pkbar to visualize progress, it gave me an ETA of nearly 20 minutes! Holy crap, I removed pkbar almost immediately.</p>\n<h2 id=\"so-why-were-there-delays\"><a href=\"#so-why-were-there-delays\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>So why were there delays?</h2>\n<p>In order to find out what was causing this huge delay and how we could avoid it, I turned for help on Stack Overflow. A particular question gave me the answer: <a href=\"https://stackoverflow.com/questions/3857052/why-is-printing-to-stdout-so-slow-can-it-be-sped-up\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Why is printing to stdout so slow? Can it be sped up?</a></p>\n<p>In this question, the author compared the following speeds:</p>\n<ul>\n<li>Writing output to the terminal, which is <code class=\"language-text\">stdout</code></li>\n<li>Writing output to a file</li>\n<li>Writing output to <code class=\"language-text\">stdout</code>, but with <code class=\"language-text\">stdout</code> redirected to <code class=\"language-text\">/dev/null</code></li>\n</ul>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-3.png\" alt=\"Time cost for printing to stdout, file and /dev/null\"><figcaption>Time cost for printing to stdout, file and /dev/null</figcaption></figure>\n<p>Wow, that shows a huge difference for printing to <code class=\"language-text\">stdout</code> and redirecting <code class=\"language-text\">stdout</code> to <code class=\"language-text\">/dev/null</code>. Even writing output to file is faster than directly writing to the terminal. Soâ€¦, why?</p>\n<blockquote>\n<p>Congratulations, you have just discovered the importance of I/O buffering. :-)</p>\n</blockquote>\n<p>So it turns out that I/O buffering is what made even â€œwriting to fileâ€ faster than â€œwriting to <code class=\"language-text\">stdout</code>â€. When we are directly writing outputs to our terminal, each writing operation is being done â€œsynchronouslyâ€, which means our programs waits for the â€œwriteâ€ to complete before it continues to the next commands.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-4.png\" alt=\"Synchronous writing to stdout\"><figcaption>Synchronous writing to stdout</figcaption></figure>\n<p>Each time our programs writes something to <code class=\"language-text\">stdout</code>, we are met with this delay. However, writing to files are not of the same case. When we are writing to files, we have what is known as â€œI/O bufferingâ€, which means the program outputs whatever it needs to write to the file, and the OS catches all these contents to write where it then stores in a file <strong>as a bulk</strong> afterwards. <strong>All our â€œwriteâ€ functions return before anything is actually written to a file.</strong></p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-5.png\" alt=\"Buffered writing output to file\"><figcaption>Buffered writing output to file</figcaption></figure>\n<p>So what should we do here? Well, in order to avoid I/O overhead, we either have to do training and update output in parallel or asynchronously like we do in GUIs when we have an UI thread and a controller, or we will need to write in bulks to <code class=\"language-text\">stdout</code> like what we are doing when writing to files. <strong>Itâ€™s a trade-off: interactivity versus bulk efficiency.</strong></p>\n<h2 id=\"what-i-did-to-visualize-pytorch-training-with-minimum-overhead\"><a href=\"#what-i-did-to-visualize-pytorch-training-with-minimum-overhead\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What I did to visualize PyTorch training with minimum overhead?</h2>\n<p>After I ditched pkbar, I found a perfect progress bar library: <a href=\"https://github.com/tqdm/tqdm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tqdm â€” A Fast, Extensible Progress Bar for Python and CLI</a>. With over 13.4k+ stars, <code class=\"language-text\">tqdm</code> is easily the best Python library for us to implement training progress visualization.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-6.png\" alt=\"tqdm in action\"><figcaption>tqdm in action</figcaption></figure>\n<p><code class=\"language-text\">tqdm</code> is simple, efficient and comes with minimal overhead. The author claims that <code class=\"language-text\">tqdm</code> only delays output for a minimum of 60ns per iteration. Thatâ€™s impressive. In addition to its low overhead, <code class=\"language-text\">tqdm</code> uses smart algorithms to predict the remaining time and to skip unnecessary iteration displays, which allows for a negligible overhead in most cases.</p>\n<h3 id=\"installation\"><a href=\"#installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Installation</h3>\n<p>Either install <code class=\"language-text\">tqdm</code> using conda directly:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">conda <span class=\"token function\">install</span> <span class=\"token parameter variable\">-c</span> conda-forge tqdm</code></pre>\n<p>And install <code class=\"language-text\">ipywidgets</code> with pip to enable Jupyter Notebook integration:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> ipywidgets</code></pre>\n<p>Or integrate the following code to your <code class=\"language-text\">environment.yml</code>:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">channels</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> conda<span class=\"token punctuation\">-</span>forge\n  <span class=\"token punctuation\">-</span> defaults\n<span class=\"token key atrule\">dependencies</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> tqdm\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">pip</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ipywidgets</code></pre>\n<p>Then run:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">conda <span class=\"token function\">env</span> update</code></pre>\n<h3 id=\"integration\"><a href=\"#integration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Integration</h3>\n<p>We can easily integrate <code class=\"language-text\">tqdm</code> into our PyTorch project. Basically what you need to do is just to wrap <code class=\"language-text\">tqdm</code> on an iterable object, and thatâ€™s it.</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> tqdm <span class=\"token keyword\">import</span> tqdm\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> tqdm<span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre>\n<pre class=\"language-text\"><code class=\"language-text\">76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 7568/10000 [00:33&lt;00:10, 229.00it/s]</code></pre>\n<p>For PyTorch <code class=\"language-text\">DataLoader</code>, we can first load our data like so:</p>\n<pre class=\"language-python\"><code class=\"language-python\">dataset_loader <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>DataLoader<span class=\"token punctuation\">(</span>dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Then initialize <code class=\"language-text\">tdqm</code>:</p>\n<pre class=\"language-python\"><code class=\"language-python\">pbar <span class=\"token operator\">=</span> tqdm<span class=\"token punctuation\">(</span>dataset_loader<span class=\"token punctuation\">)</span></code></pre>\n<p>Here, we can add the description of the progress bar:</p>\n<pre class=\"language-python\"><code class=\"language-python\">pbar<span class=\"token punctuation\">.</span>set_description<span class=\"token punctuation\">(</span><span class=\"token string\">'Validate predictions'</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Also, we can initialize the post-fix dict for the progress bar, so that we can update the post-fix on the fly:</p>\n<pre class=\"language-python\"><code class=\"language-python\">pbar<span class=\"token punctuation\">.</span>set_postfix<span class=\"token punctuation\">(</span>loss<span class=\"token operator\">=</span><span class=\"token string\">'0.0%'</span><span class=\"token punctuation\">,</span> acc<span class=\"token operator\">=</span><span class=\"token string\">'0.0%'</span><span class=\"token punctuation\">)</span></code></pre>\n<p>And VoilÃ ! We can directly iterate through <code class=\"language-text\">tdqm</code>, just like we did with PyTorch <code class=\"language-text\">DataLoader</code>. (My model is wrapped with Foolbox, so I can make predictions with the <code class=\"language-text\">.forward()</code> function.)</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> image<span class=\"token punctuation\">,</span> label <span class=\"token keyword\">in</span> pbar<span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># make a prediction</span>\n  prob <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>  <span class=\"token comment\"># calculate and update loss</span>\n  pbar<span class=\"token punctuation\">.</span>set_postfix<span class=\"token punctuation\">(</span>loss<span class=\"token operator\">=</span><span class=\"token string\">'{:.2f}%'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\"># calculate and update accuracy</span>\n  pbar<span class=\"token punctuation\">.</span>set_postfix<span class=\"token punctuation\">(</span>acc<span class=\"token operator\">=</span><span class=\"token string\">'{:.2f}%'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre>\n<h3 id=\"features\"><a href=\"#features\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Features</h3>\n<p><code class=\"language-text\">tqdm</code> can be used directly in a CLI environment with no special configuration whatsoever.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-7.gif\" alt=\"tqdm in a CLI enviroment\"><figcaption>tqdm in a CLI enviroment</figcaption></figure>\n<p>Also, we can run <code class=\"language-text\">tqdm</code> in VS Codeâ€™s Python Interactive console, or Jupyter Notebook. In this case, <code class=\"language-text\">tqdm</code> will output progress asynchronously according to the <a href=\"https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Running%20Code.html#Output-is-asynchronous\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Notebook API</a>.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-8.gif\" alt=\"tqdm outputting inside Jupyter Notebook / VS Code Python Interactive\"><figcaption>tqdm outputting inside Jupyter Notebook / VS Code Python Interactive</figcaption></figure>\n<p>To kick it up a notch, we can actually output â€œrealâ€ progress bars. Utilizing <code class=\"language-text\">ipywidget</code>, we can directly draw interactive progress bars inside Jupyter Notebook. <a href=\"https://ipywidgets.readthedocs.io/en/latest/user_install.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">See here for instructions on how to enable </a><code class=\"language-text\">ipywidgets</code><a href=\"https://ipywidgets.readthedocs.io/en/latest/user_install.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.</a></p>\n<p>After enabling these widgets inside Jupyter Notebook, all we have to do is change the way on how we imported <code class=\"language-text\">tqdm</code>. Change:</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> tqdm <span class=\"token keyword\">as</span> tqdm</code></pre>\n<p>To:</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> tqdm<span class=\"token punctuation\">.</span>notebook <span class=\"token keyword\">as</span> tqdm</code></pre>\n<p>Now, run the code once more, if everything goes well, we should be able to see a neat progress bar with colors indicating the current taskâ€™s state: pending, success or failure.</p>\n<figure><img src=\"https://cdn.spencer.felinae98.cn/blog/2020/07/20200722-215810-9.gif\" alt=\"tqdm integrating directly into Jupyter Notebook with ipywidgets - https://ipywidgets.readthedocs.io/en/latest\"><figcaption>tqdm integrating directly into Jupyter Notebook with ipywidgets - https://ipywidgets.readthedocs.io/en/latest</figcaption></figure>\n<hr>\n<p>This is the end of the article, for more information on how to utilize <code class=\"language-text\">tqdm</code>, I recommend this article: <a href=\"https://medium.com/better-programming/python-progress-bars-with-tqdm-by-example-ce98dbbc9697\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Python Progress Bars with tqdm by Example</a>. Also, the official documentation of <code class=\"language-text\">tqdm</code> is quite thorough, covering most cases when using <code class=\"language-text\">tqdm</code>.</p>\n<p>Thereâ€™s one thing to note, and that is: you should not use â€œprintâ€ to output anything when a <code class=\"language-text\">tqdm</code> progress bar is running, as this behavior will mess up the <code class=\"language-text\">tqdm</code> output. If you have to write something, do remember to use:</p>\n<pre class=\"language-python\"><code class=\"language-python\">tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>context<span class=\"token operator\">></span><span class=\"token punctuation\">)</span></code></pre>\n<p>Thatâ€™s all, thanks for reading.</p>\n"}}]}}},"context":{}}